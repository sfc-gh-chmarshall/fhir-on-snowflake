spec:
  containers:
  - name: hapi-fhir
    image: /fullstack_db/devops/images/hapi-fhir:latest
    env:
      SPRING_DATASOURCE_URL: "${SPRING_DATASOURCE_URL}"
      SPRING_DATASOURCE_USERNAME: "fhir_app"
      SPRING_DATASOURCE_DRIVER_CLASS_NAME: "org.postgresql.Driver"
      SPRING_JPA_PROPERTIES_HIBERNATE_DIALECT: "ca.uhn.fhir.jpa.model.dialect.HapiFhirPostgresDialect"
      HAPI_FHIR_TESTER_HOME_SERVER_ADDRESS: "${HAPI_FHIR_TESTER_HOME_SERVER_ADDRESS:-http://fhir-server:8080/fhir}"
      HAPI_FHIR_TESTER_HOME_NAME: "SPCS FHIR Server"
    secrets:
    - snowflakeSecret:
        objectName: fullstack_db.hapi_fhir.fhir_db_password
      secretKeyRef: secret_string
      envVarName: SPRING_DATASOURCE_PASSWORD
    resources:
      requests:
        memory: 4Gi
        cpu: 2000m
      limits:
        memory: 8Gi
        cpu: 4000m
    readinessProbe:
      port: 8080
      path: /actuator/health
  endpoints:
  - name: fhir-api
    port: 8080
    public: true
